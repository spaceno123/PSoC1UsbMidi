;
;	USB MIDI descriptor
;	Generated by the USB Setup Wizard
;	Modifyed for USB MIDI by AKIYA
;	See:USB Device Class Definition for MIDI Devices
;	    Appendix B. Example: Simple MIDI Adapter
;
;-----------------------------------------------
; USB Descriptors--Generated by the USB Setup Wizard
;-----------------------------------------------
AREA  lit     (ROM,REL,CON)
;----------------------------------------------------------------------
; Descriptor Dispatch Tables
;   The following tables provide the dispatching pointers and
;   descriptor lengths necessary for the request handler to
;   respond to USB requests.
;----------------------------------------------------------------------

;----------------------------------------------------------------------
; Device Dispatch Table
;   for User Module: (USBFS)
;----------------------------------------------------------------------
AREA  lit     (ROM,REL,CON)
EXPORT USBFS_DEVICE_LOOKUP
.LITERAL
USBFS_DEVICE_LOOKUP:                             ;
  LT_START    1                                  ; Number of devices defined for USBFS
  LT_ENTRY    USBFS_D0_CONFIG_LOOKUP, USBFS_D0_CONFIG_DESCR_TABLE
.ENDLITERAL

;----------------------------------------------------------------------
; Configuration Dispatch Table
;   for Device: (USBFS_D0)
;----------------------------------------------------------------------
AREA  lit     (ROM,REL,CON)
EXPORT USBFS_D0_CONFIG_LOOKUP
.LITERAL
USBFS_D0_CONFIG_LOOKUP:                          ;
  LT_START    1                                  ; Number of configurations
  LT_ENTRY    USBFS_D0_C1_EP_SETUP, NULL_PTR     ; No HID Class Descriptors
.ENDLITERAL

;----------------------------------------------------------------------
; Endpoint Setup Table
; 
; This table provides the data to configure the endpoint mode registers
; for IN/OUT direction.
;----------------------------------------------------------------------
AREA  lit     (ROM,REL,CON)
.LITERAL
USBFS_D0_C1_EP_SETUP:                            ;
  DB    USB_DIR_OUT                              ; Endpoint EP1(OUT)
  DB    USB_DIR_IN                               ; Endpoint EP2(IN)
  DB    USB_DIR_UNUSED                           ; Endpoint EP3 not used for this configuration
  DB    USB_DIR_UNUSED                           ; Endpoint EP4 not used for this configuration
.ENDLITERAL

;----------------------------------------------------------------------
; Interface Lookup Table
; 
; This table is indexed by interface number.
;
;----------------------------------------------------------------------
EXPORT USBFS_D0_C1_INTERFACE_RPT_LOOKUP
.LITERAL
USBFS_D0_C1_INTERFACE_RPT_LOOKUP:                ;
  DW    0                                        ; HID Class Reports not defined for this interface
  DW    0                                        ; HID Class Reports not defined for this interface
.ENDLITERAL

;----------------------------------------------------------------------
; HID Class Descriptor transfer descriptor table
;----------------------------------------------------------------------
AREA  lit     (ROM,REL,CON)
EXPORT USBFS_D0_C1_HID_CLASS_DESCR_TABLE
.LITERAL
USBFS_D0_C1_HID_CLASS_DESCR_TABLE:               ;
  TD_START_TABLE 2                               ; Number of interfaces/HID Class Descriptors
  TD_ENTRY       USB_DS_ROM, 0, NULL_PTR, NULL_PTR
  TD_ENTRY       USB_DS_ROM, 0, NULL_PTR, NULL_PTR
.ENDLITERAL

;----------------------------------------------------------------------
; Configuration Descriptor Table
;  for (USBFS_D0)
;
;	This table provides transfer descriptors for each USB Configuration
; Descriptor
;----------------------------------------------------------------------
AREA  lit     (ROM,REL,CON)
.LITERAL
USBFS_D0_CONFIG_DESCR_TABLE:                     ;
  TD_START_TABLE 1                               ; Number of configurations
  TD_ENTRY       USB_DS_ROM, USBFS_D0_C1_DESCR_SIZE, USBFS_D0_C1_DESCR_START, NULL_PTR
.ENDLITERAL

;----------------------------------------------------------------------
; Device Descriptor Table
;
;	This table provides transfer descriptors for each USB Device Descriptor
;----------------------------------------------------------------------
AREA  lit     (ROM,REL,CON)
EXPORT USBFS_DEVICE_DESCR_TABLE
.LITERAL
USBFS_DEVICE_DESCR_TABLE:                        
  TD_START_TABLE 1                               ; Number of devices
  TD_ENTRY       USB_DS_ROM, USBFS_D0_DESCR_SIZE, USBFS_D0_DESCR_START, NULL_PTR
.ENDLITERAL
;----------------------------------------------------------------------
;----------------------------------------------------------------------
; Device Descriptor (USBFS_D0)
; This marks the beginning of the Device Descriptor.  This descriptor
; concatenates all of the descriptors in the following format:
;	Device Descriptor
;		Configuration Descriptor (1)
;	  	Interface 1 Descriptor
;				HID Descriptor 1
;			  	Endpoint Descriptor(s)
;			Interface 2 Descriptor
;				HID Descriptor 2
;					Endpoint Descriptor(s)
;		Configuration Descriptor (2)
;			Interface/HID/Endpoint...
;----------------------------------------------------------------------
AREA  lit     (ROM,REL,CON)
.LITERAL
USBFS_D0_DESCR_START:                            ;
  DB    18                                       ; Device Descriptor Length (18)
  DB    1                                        ; bDescriptorType: DEVICE
  DWL   0200H                                    ; bcdUSB (ver 2.0)
  DB    0                                        ; bDeviceClass
  DB    0                                        ; bDeviceSubClass 
  DB    0                                        ; bDeviceProtocol 
  DB    8                                        ; bMaxPacketSize0
  DWL   FFFFH                                    ; idVendor
  DWL   0001H                                    ; idProduct
  DWL   0000H                                    ; bcdDevice
  DB    STR_HASH_2                               ; iManufacturer
  DB    STR_HASH_3                               ; iProduct
  DB    STR_HASH_0                               ; iSerialNumber
  DB    1                                        ; bNumConfigurations
USBFS_D0_DESCR_END:                              ;
USBFS_D0_DESCR_SIZE:  EQU    USBFS_D0_DESCR_END - USBFS_D0_DESCR_START

;----------------------------------------------------------------------
; Configuration Descriptor (USBFS_D0_C1)
; This marks the beginning of the Configuration Descriptor.  This descriptor
; concatenates all of the descriptors in the following format:
; Configuration Descriptor
;	Interface 1 Descriptor
;		HID Descriptor 1
;			Endpoint Descriptor(s)
;	Interface 2 Descriptor
;		HID Descriptor 2
;			Endpoint Descriptor(s)
;----------------------------------------------------------------------
USBFS_D0_C1_DESCR_START:                         ;
  DB    9                                        ; Configuration Descriptor Length (9)
  DB    2                                        ; bDescriptorType: CONFIGURATION
  DWL   USBFS_D0_C1_DESCR_SIZE                   ; wTotalLength
  DB    2                                        ; bNumInterfaces
  DB    1                                        ; bConfigurationValue
  DB    STR_HASH_0                               ; iConfiguration
  DB    80H | (0 << 6) | (0 << 5)                ; bmAttributes >
  DB    50                                       ; bMaxPower
;----------------------------------------------------------------------
; Interface Descriptor (USBFS_D0_C1_I0)
;----------------------------------------------------------------------
  DB    9                                        ; Interface Descriptor Length (9)
  DB    4                                        ; bDescriptorType: INTERFACE
  DB    0                                        ; bInterfaceNumber (zero based)
  DB    0                                        ; bAlternateSetting
  DB    0                                        ; bNumEndpoints
  DB    1                                        ; bInterfaceClass: AUDIO.
  DB    1                                        ; bInterfaceSubClass: AUDIO_CONTROL.
  DB    0                                        ; bInterfaceProtocol
  DB    STR_HASH_0                               ; iInterface
;----------------------------------------------------------------------
  DB    9                                        ; Size of this descriptor, in bytes.
  DB    24H                                      ; bDescriptorType: CS_INTERFACE.
  DB    1                                        ; bDescriptorSubtype: HEADER subtype.
  DWL   0100H                                    ; bcdADC
  DWL   0009H                                    ; wTotalLength
  DB    1                                        ; bInCollection
  DB    1                                        ; baInterfaceNr(1)
;----------------------------------------------------------------------
; Interface Descriptor (USBFS_D0_C1_I1)
;----------------------------------------------------------------------
  DB    9                                        ; Interface Descriptor Length (9)
  DB    4                                        ; bDescriptorType: INTERFACE
  DB    1                                        ; bInterfaceNumber (zero based)
  DB    0                                        ; bAlternateSetting
  DB    2                                        ; bNumEndpoints
  DB    1                                        ; bInterfaceClass: AUDIO.
  DB    3                                        ; bInterfaceSubClass: MIDISTREAMING.
  DB    0                                        ; bInterfaceProtocol
  DB    STR_HASH_0                               ; iInterface
;----------------------------------------------------------------------
  DB    7                                        ; Size of this descriptor, in bytes.
  DB    24H                                      ; bDescriptorType: CS_INTERFACE descriptor.
  DB    1                                        ; bDescriptorSubtype: MS_HEADER subtype.
  DWL   0100H                                    ; BcdADC
  DWL   0041H                                    ; wTotalLength
;----------------------------------------------------------------------
  DB    6                                        ; Size of this descriptor, in bytes.
  DB    24H                                      ; bDescripto rType: CS_INTERFACE descriptor.
  DB    2                                        ; bDescriptorSubtype: MIDI_IN_JACK subtype.
  DB    1                                        ; bJackType: EMBEDDED.
  DB    1                                        ; bJackID
  DB    STR_HASH_0                               ; iJack
;----------------------------------------------------------------------
  DB    6                                        ; Size of this descriptor, in bytes.
  DB    24H                                      ; bDescripto rType: CS_INTERFACE descriptor.
  DB    2                                        ; bDescriptorSubtype: MIDI_IN_JACK subtype.
  DB    2                                        ; bJackType: EXTERNAL.
  DB    2                                        ; bJackID
  DB    STR_HASH_0                               ; iJack
;----------------------------------------------------------------------
  DB    9                                        ; Size of this descriptor, in bytes.
  DB    24H                                      ; bDescriptorType: CS_INTERFACE descriptor.
  DB    3                                        ; bDescriptorSubtype: MIDI_OUT_JACK subtype.
  DB    1                                        ; bJackType: EMBEDDED.
  DB    3                                        ; bJackID
  DB    1                                        ; bNrInputPins
  DB    2                                        ; BaSourceID(1)
  DB    1                                        ; BaSourcePin(1)
  DB    STR_HASH_0                               ; iJack
;----------------------------------------------------------------------
  DB    9                                        ; Size of this descriptor, in bytes.
  DB    24H                                      ; bDescriptorType: CS_INTERFACE descriptor.
  DB    3                                        ; bDescriptorSubtype: MIDI_OUT_JACK subtype.
  DB    2                                        ; bJackType: EXTERNAL.
  DB    4                                        ; bJackID
  DB    1                                        ; bNrInputPins
  DB    1                                        ; BaSourceID(1)
  DB    1                                        ; BaSourcePin(1)
  DB    STR_HASH_0                               ; iJack
;----------------------------------------------------------------------
; Endpoint Descriptor (USBFS_D0_C1_I1_E0)
;----------------------------------------------------------------------
  DB    9                                        ; Endpoint Descriptor Length (9)
  DB    5                                        ; bDescriptorType: ENDPOINT
  DB    (EP1 | USB_DIR_OUT)                      ; bEndpointAddress
  DB    2                                        ; bmAttributes
  DWL   64                                       ; wMaxPacketSize
  DB    0                                        ; bInterval
  DB    0                                        ; bRefresh
  DB    0                                        ; bSynchAddress
;----------------------------------------------------------------------
  DB    5                                        ; Size of this descriptor, in bytes.
  DB    25H                                      ; bDescriptorType: CS_ENDPOINT descriptor
  DB    1                                        ; bDescriptorSubtype: MS_GENERAL subtype.
  DB    1                                        ; bNumEmbMIDIJack
  DB    1                                        ; BaAssocJackID(1)
;----------------------------------------------------------------------
; Endpoint Descriptor (USBFS_D0_C1_I1_E1)
;----------------------------------------------------------------------
  DB    9                                        ; Endpoint Descriptor Length (9)
  DB    5                                        ; bDescriptorType: ENDPOINT
  DB    (EP2 | USB_DIR_IN)                       ; bEndpointAddress
  DB    2                                        ; bmAttributes
  DWL   64                                       ; wMaxPacketSize
  DB    0                                        ; bInterval
  DB    0                                        ; bRefresh
  DB    0                                        ; bSynchAddress
;----------------------------------------------------------------------
  DB    5                                        ; Size of this descriptor, in bytes.
  DB    25H                                      ; bDescriptorType: CS_ENDPOINT descriptor
  DB    1                                        ; bDescriptorSubtype: MS_GENERAL subtype.
  DB    1                                        ; bNumEmbMIDIJack
  DB    3                                        ; BaAssocJackID(1)
;----------------------------------------------------------------------
USBFS_D0_C1_DESCR_END:
USBFS_D0_C1_DESCR_SIZE:	EQU	(USBFS_D0_C1_DESCR_END - USBFS_D0_C1_DESCR_START)
.ENDLITERAL
;----------------------------------------------------------------------
; USB String Descriptors
;
; This section contains the USB String Descriptors generated
; by the USB User Module Descriptor Generator
;
; Note:  The string labels are internally generated by the
; descriptor generator
;
; Descriptors that reference string descriptors, use a hashed
; symbol that is set in an EQU directive with each string
; descriptor.
;----------------------------------------------------------------------
STR_HASH_0:  EQU    0                            ; String Hash for the null string
AREA  lit     (ROM,REL,CON)
EXPORT USBFS_StringTable
.LITERAL
USBFS_StringTable:                               
  TD_START_TABLE 3                               ; Number of USB Strings
  TD_ENTRY       USB_DS_ROM, LANGID_DESCR_SIZE, LANGID_DESCR_START, NULL_PTR
  TD_ENTRY       USB_DS_ROM, STRING_2_DESCR_SIZE, STRING_2_DESCR_START, NULL_PTR
  TD_ENTRY       USB_DS_ROM, STRING_3_DESCR_SIZE, STRING_3_DESCR_START, NULL_PTR
;----------------------------------------------------------------------
; LANGID Descriptor
;----------------------------------------------------------------------
LANGID_DESCR_START:                              
  DB    ((1 * 2) + 2)                            ; bLength (N+2)
  DB    3                                        ; bDescriptorType (STRING)
  DWL   1033                                     ;
LANGID_DESCR_END:                                
LANGID_DESCR_SIZE:  EQU    (LANGID_DESCR_END - LANGID_DESCR_START)
;----------------------------------------------------------------------
; String Desciptor
;----------------------------------------------------------------------
STR_HASH_2:  EQU    1                            ; String Hash
STRING_2_DESCR_START:                            
  DB    STRING_2_DESCR_SIZE                      ; bLength
  DB    3                                        ; bDescriptorType (STRING)
  DSU   "Private"                                ;
STRING_2_DESCR_END:                              
STRING_2_DESCR_SIZE:  EQU    (STRING_2_DESCR_END - STRING_2_DESCR_START)
;----------------------------------------------------------------------
; String Desciptor
;----------------------------------------------------------------------
STR_HASH_3:  EQU    2                            ; String Hash
STRING_3_DESCR_START:                            
  DB    STRING_3_DESCR_SIZE                      ; bLength
  DB    3                                        ; bDescriptorType (STRING)
  DSU   "Midi Cable"                             ;
STRING_3_DESCR_END:                              
STRING_3_DESCR_SIZE:  EQU    (STRING_3_DESCR_END - STRING_3_DESCR_START)
.ENDLITERAL

;-----------------------------------------------
; End of Descriptors
;-----------------------------------------------
